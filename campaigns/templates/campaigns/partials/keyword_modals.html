{% load django_bootstrap5 %}

{# Edit keyword modal #}
{% partialdef edit_keyword_modal %}
<div class="modal fade" id="editKeywordModal{{ keyword.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Keyword</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form hx-post="{% url 'campaigns:keyword_update' keyword.pk %}" hx-target="#keyword_card_{{ keyword.id }}"
                hx-swap="outerHTML">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="name" value="{{ keyword.name }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" rows="2">{{ keyword.description }}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endpartialdef %}

{# Delete keyword modal #}
{% partialdef delete_keyword_modal %}
<div class="modal fade" id="deleteKeywordModal{{ keyword.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header bg-danger">
                <h6 class="modal-title">Delete Keyword?</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form hx-post="{% url 'campaigns:keyword_delete' keyword.pk %}" hx-target="#keywords_container"
                hx-swap="innerHTML">
                {% csrf_token %}
                <div class="modal-body">
                    <p class="mb-0">Delete <strong>{{ keyword.name }}</strong>?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endpartialdef %}

{# Create tag modal #}
{% partialdef create_tag_modal %}
<div class="modal fade" id="createTagModal{{ keyword.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Add Tag</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form hx-post="{% url 'campaigns:tag_create' keyword.pk %}" hx-target="#keyword_card_{{ keyword.id }}"
                hx-swap="outerHTML">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control form-control-sm" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-control form-control-sm" name="description">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-sm">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endpartialdef %}

{# Delete tag modal #}
{% partialdef delete_tag_modal %}
<div class="modal fade" id="deleteTagModal{{ tag.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header bg-danger">
                <h6 class="modal-title">Delete Tag?</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form hx-post="{% url 'campaigns:tag_delete' tag.pk %}" hx-target="#keyword_card_{{ keyword.id }}"
                hx-swap="outerHTML">
                {% csrf_token %}
                <div class="modal-body">
                    <p class="mb-0">Delete tag <strong>{{ tag.name }}</strong>?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endpartialdef %}

{# Create keyword modal #}
{% partialdef create_keyword_modal %}
<div class="modal fade" id="createKeywordModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Keyword</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form hx-post="{% url 'campaigns:keyword_create' campaign.pk %}" hx-target="#keywords_container"
                hx-swap="innerHTML">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="name" placeholder="e.g., Python, Django, AI"
                            required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" rows="2"
                            placeholder="What to look for..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Keyword</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endpartialdef %}

{# Render modals for keyword and tags only when called from keyword_card #}
{% if render_keyword_modals %}
{% partial edit_keyword_modal %}
{% partial delete_keyword_modal %}
{% partial create_tag_modal %}
{% for tag in keyword.tags.all %}
{% partial delete_tag_modal %}
{% endfor %}
{% endif %}

{# Render create keyword modal if flag is set #}
{% if render_create_keyword_modal %}
{% partial create_keyword_modal %}
{% endif %}